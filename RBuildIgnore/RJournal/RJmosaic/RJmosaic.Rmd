---
title: The mosaic package
author:
  - name: Randall Pruim
    affiliation: Calvin College
    address:
    - 3201 Burton St SE
    - Grand Rapids, MI 49546
    email:  rpruim@calvin.edu
  - name: Daniel T Kaplan
    affiliation: Macalester College
    address:
    - address 1
    - address 2
    email:  dtkaplan@macalester.edu
  - name: Nicholas J Horton
    affiliation: Amherst College
    address:
    - address 1
    - address 2
    email:  nhorton@amherst.edu
abstract: >
  An abstract of less than 150 words.
preamble: >
  % Any extra latex you need in the preamble
output: rticles::rjournal_article
---

```{r, include=FALSE}
require(mosaic)
knitr::opts_chunk$set(fig.width = 3, fig.height = 2)
options(digits = 3)
```

# Less volume, more creativity

The \CRANpkg{mosaic} package originated in early attempts by each of the authors to 
ease new users into using R, primarily in the context of 
undergraduate statistics courses, and, in one case, also in calculus.
One of the guiding principles behind the development of the \CRANpkg{mosaic} package
has been "Less volume, more creativity".  Beginners are easily overwhelmed by the 
scope of R and its many packages.  Often there are multiple ways to accomplish the 
same task, and authors of the many packages are not required to follow any particular
style guidelines.  

Early on in the development of \CRANpkg{mosaic}, we decided to
reduce the number of code templates that users would need to know to as few as possible,
while still providing them with substantial power to be creative within the
templates provided. 

# The formula template

To successfully implement a "less volume, more creativity" approach, one must decide
which tasks are most important to accomplish.  We knew from the outset, that
this would include graphical and numerical summaries of data and various models
and inference procedures.  Because of this, 
our most important template makes use what we call the "formula-interface'' and
is modeled after \code{lm()} and the plotting functions in \CRANpkg{lattice}. 


We typically introduce the formula template in the context of exploring 
two variables as 

```{r, eval=FALSE}
goal( y ~ x, data=mydata )
```
\noindent
This template allows us to create, for example, scatterplots and side-by-side box plots
```{r, fig.keep = "none"}
xyplot(length ~ width, data = KidsFeet)
bwplot(length ~ sex,   data = KidsFeet)
```
\noindent
With the \CRANpkg{mosaic} we can use the same template to create numerical summaries like
```{r}
mean(length ~ sex, data = KidsFeet)
mean(length ~ sex, data = KidsFeet, .format = "table")
sd(length ~ sex, data = KidsFeet)
favstats(length ~ sex, data = KidsFeet)
```

The formula template can be modified to handle one variable:
```{r, eval=FALSE}
goal( ~ x, data=mydata )
```
or more variables
```{r, eval=FALSE}
goal( y ~ x | z, groups = mygroups, data=mydata )
```
\noindent
When plotting, `z` is used to create plots with subpanels (or facets) and `groups` is
used overlay multiple layers.  The \CRANpkg{mosaic} package

As students become familiar with the formula interface,
all three forms can be brought together into a single template:

```{r, eval=FALSE}
goal( formula, data=mydata, ... )
```

The formula template allows us to very quickly introduce students to 
thinking about relationships between and among two or more variables.
Having learned the formula interface to graphical and numerical
summaries ealy on, new users are well prepared for modeling with
\code{lm()}, \code{glm()}, and various "test" functions such as
`t.test()` when the time comes. 

## Adding the formula interface to existing functions

Although this formula interface works well for graphical summaries of data
using the \CRANpkg{lattice} package, the same is not true of the standard 
numerical summary functions (\code{mean()}, 
\code{median()}, \code{sd()}, etc.).  One of our initial
difficult decisions was whether to add such a formula interface to these
standard functions (by masking them) or to create new functions.  We decided on the former 
option because the standard names are natural and familiar and because 
having two sets of functions for essentially the same task would be unnecessarily 
complicated for new users.  
The \CRANpkg{mosaic} 
versions of these functions can still be used as in the \CRANpkg{stats} and \CRANpkg{base} packages so that existing code should not be affected, even when
the \CRANpkg{mosaic} package is attached.  (There is, however, a performance penalty
to paid, so when performance is crucial, it may be best to avoid using the \CRANpkg{mosaic}
versions of the standard numerical summary functions.

```{r}
mean( HELPrct$age )
mean( ~ age, data = HELPrct )      # same result as above 
mean( age ~ sex, data = HELPrct )  # additional features are possible
```

There are, of course, other ways to achieve this last result, including the use of 
\code{aggregate()}, or \code{summary()} from \CRANpkg{Hmisc}, or the functions in 
\CRANpkg{plyr}.   But each of these solutions would require learning additional
templates.  In our approach, the following (and many more) are all identical except for 
the specification of the desired result via the function name.

```{r, tidy=FALSE, eval=FALSE}
bwplot( age ~ sex, data=HELPrct )
  mean( age ~ sex, data=HELPrct )
    sd( age ~ sex, data=HELPrct )
    lm( age ~ sex, data=HELPrct )
t.test( age ~ sex, data=HELPrct )   
```

Similarly, by adding additional formula interfaces to `t.test()`,
`binom.test()`, and `prop.test()`, for one-variable situations we have 

```{r, tidy=FALSE, eval=FALSE}
      mean( ~ age, data=HELPrct )
        sd( ~ age, data=HELPrct )
  favstats( ~ age, data=HELPrct )
 histogram( ~ age, data=HELPrct )
    t.test( ~ age, data=HELPrct )       # formula interface added in mosaic
binom.test( ~ sex, data=HELPrct )       # formula interface added in mosaic
 prop.test( ~ sex, data=HELPrct )       # formula interface added in mosaic
```

And for plots and numerical summaries, we can add covariates into the mix as well:
```{r, tidy=FALSE, eval=FALSE}
     mean( ~ age | sex, data=HELPrct )
       sd( ~ age | sex, data=HELPrct )
histogram( ~ age | sex, data=HELPrct )
   t.test( ~ age | sex, data=HELPrct )
```

## Some things that we didn't change

The formula interface is powerful and flexible.  Nevertheless, there are some
sticky issues that we have chosen not to address.

###	The geometry of lattice formulas

		In \code{lm()}, \code{glm()} and the numerical summary functions, \code{y ~ x} can
		typically be read as 
		``\code{y} depends on \code{x}'' or
		``\code{y} is modeled by \code{x}''.  From this perspective,
		
```{r eval=FALSE}
histogram(age ~ sex, data=HELPrct)
```

would be perfectly reasonable.  But \CRANpkg{lattice}, for the most part, 
uses the \code{y} and \code{x} slots to indicate which axis of the plot is used 
for which variable. So the correct \CRANpkg{lattice} command for the desired
pair of histograms is 

```{r, eval=FALSE}
histogram(~ age | sex, data=HELPrct)
```

and for overlaid density plots it is 

```{r eval=FALSE}
histogram(~ age, groups=sex, data=HELPrct)
```

While this can produce some initial challenges for users, clearly explaining the roles 
of the components of the variables for plotting, for numerical summaries, and for model 
fitting helps demystify the situation.  Furthermore, in several functions we promote formulas
of the form \code{~ x | z} to \code{x ~ z} to allow either format.  Similarly, the \code{groups}
argument can often be used, for example

```{r}
mean( ~ age, groups = sex, data=HELPrct )  
```

### Handling missing data

When there are missing values,
the numerical summary functions in \CRANpkg{base} and \CRANpkg{stats} return
results that surprise and confuse new users.
```{r}
mean( HELPmiss$dayslink )
```
We offer two solutions to this situtation.  Our favorite is the `favstats()` function
which computes a number of our favorite numerical summaries and reports the number of 
missing values.
```{r}
favstats( dayslink ~ sex, data = HELPmiss )
```


## Other stuff as we think of it


# Extracting information

Modeled on functions like \code{resid()}, a number of additional functions have
been added to \CRANpkg{mosaic} to facilitate extracting information from more
complicated objects.  Some examples include

```{r, extractors}
confint(t.test(~age, data=HELPrct))      # works for "htest" objects
pval( t.test(age ~ sex, data=HELPrct))   # works for "htest" objects
stat( t.test(age ~ sex, data=HELPrct))   # works for "htest" objects
r.squared( lm( age ~ sex, data=HELPrct))
```

\section{Simplifying randomization}

\subsection{Using do() for repetition}

\subsection{sample(), resample(), and shuffle()}

\subsection{do() and confint()}

\subsection{statTally()}


\section{Calculus in R}

\section{Some additional bells and whistles}




## Introduction

Introductory section which may include references in parentheses
\citep{R}, or cite a reference such as \citet{R} in the text.

## Section title in sentence case

This section may contain a figure such as Figure \ref{figure:rlogo}.

\begin{figure}[htbp]
  \centering
  \includegraphics{Rlogo}
  \caption{The logo of R.}
  \label{figure:rlogo}
\end{figure}

## Another section

There will likely be several sections, perhaps including code snippets, such as:

```{r}
x <- 1:10
x
```


## Summary

This file is only a basic article template. For full details of _The R Journal_ style and information on how to prepare your article for submission, see the [Instructions for Authors](http://journal.r-project.org/latex/RJauthorguide.pdf).

## Scrap

This template allows us to create scatterplots and side-by-side box plots
```{r, fig.keep = "none"}
xyplot(length ~ width, data = KidsFeet)
bwplot(length ~ sex,   data = KidsFeet)
```
to create numerical summaries like
```{r}
mean(length ~ sex, data = KidsFeet)
sd(length ~ sex, data = KidsFeet)
favstats(length ~ sex, data = KidsFeet)
```


\bibliography{RJreferences}
%\bibliography{pruim-horton-kaplan}
